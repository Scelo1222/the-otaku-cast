<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Otaku Cast - Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/pouchdb@8.0.1/dist/pouchdb.min.js"></script>
    <style>
        :root {
            --primary-color: #4a148c;
            --secondary-color: #7b1fa2;
            --accent-color: #e91e63;
            --light-color: #f3e5f5;
            --dark-color: #12005e;
            --text-color: #212121;
            --light-text: #f5f5f5;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--text-color);
            line-height: 1.6;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--light-text);
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .tagline {
            font-style: italic;
            margin-bottom: 1rem;
        }
        
        .user-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        
        nav {
            background-color: var(--dark-color);
            padding: 0.5rem;
        }
        
        nav ul {
            display: flex;
            justify-content: center;
            list-style: none;
            flex-wrap: wrap;
        }
        
        nav li {
            margin: 0 1rem;
        }
        
        nav a {
            color: var(--light-text);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        nav a:hover {
            background-color: var(--secondary-color);
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .section {
            background-color: white;
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            color: var(--primary-color);
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .card-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .card {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 1.5rem;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        
        .card-title {
            color: var(--secondary-color);
            margin-bottom: 1rem;
        }
        
        .mission-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .mission-card {
            background-color: white;
            border-left: 4px solid var(--accent-color);
            border-radius: 4px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .mission-rank {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .low-rank {
            border-left-color: var(--success-color);
        }
        
        .intermediate-rank {
            border-left-color: var(--warning-color);
        }
        
        .high-rank {
            border-left-color: var(--error-color);
        }
        
        .members-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .member-card {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }
        
        .admin {
            border: 2px solid var(--accent-color);
        }
        
        .vice-admin {
            border: 2px solid var(--secondary-color);
        }
        
        .meeting-info {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .meeting-details {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .suggestion-form, .login-form, .admin-panel {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: var(--primary-color);
        }
        
        .btn-danger {
            background-color: var(--error-color);
        }
        
        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-warning {
            background-color: var(--warning-color);
        }
        
        footer {
            background-color: var(--dark-color);
            color: var(--light-text);
            text-align: center;
            padding: 1.5rem;
            margin-top: 2rem;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 1rem;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--accent-color);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .suggestions-list {
            margin-top: 1.5rem;
        }
        
        .suggestion-item {
            background-color: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .suggestion-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .suggestion-title {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .suggestion-meta {
            font-size: 0.9rem;
            color: #666;
        }
        
        .login-container {
            max-width: 400px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .login-title {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--primary-color);
        }
        
        .hidden {
            display: none;
        }
        
        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem;
            border-radius: 4px;
            color: white;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .notification.success {
            background-color: var(--success-color);
        }
        
        .notification.error {
            background-color: var(--error-color);
        }
        
        .notification.warning {
            background-color: var(--warning-color);
        }
        
        @media (max-width: 768px) {
            nav ul {
                flex-direction: column;
                align-items: center;
            }
            
            nav li {
                margin: 0.25rem 0;
            }
            
            .card-container, .mission-grid, .members-list {
                grid-template-columns: 1fr;
            }
            
            .user-controls {
                position: static;
                justify-content: center;
                margin-top: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <h2 class="login-title">The Otaku Cast Portal</h2>
        <form id="loginForm">
            <div class="form-group">
                <label for="username">Username:</label>
                <input type="text" id="username" required>
            </div>
            
            <div class="form-group">
                <label for="password">Password:</label>
                <input type="password" id="password" required>
            </div>
            
            <button type="submit" style="width: 100%;">Login</button>
        </form>
        <div style="margin-top: 1rem; text-align: center;">
            <p>Demo Accounts:</p>
            <p>Admin: admin / admin123</p>
            <p>Member: member / member123</p>
        </div>
    </div>
    
    <!-- Main Portal (hidden until login) -->
    <div id="mainPortal" class="hidden">
        <header>
            <div class="logo">THE OTAKU CAST</div>
            <div class="tagline">Where Otakus convene to discuss all matters anime and comics</div>
            
            <div class="user-controls">
                <div class="user-info">
                    <div class="avatar" id="userAvatar">U</div>
                    <span id="userName">User</span>
                </div>
                <button id="logoutBtn">Logout</button>
            </div>
        </header>
        
        <nav>
            <ul>
                <li><a href="#foundation">Foundation</a></li>
                <li><a href="#rules">Rules</a></li>
                <li><a href="#events">Events</a></li>
                <li><a href="#members">Members</a></li>
                <li><a href="#missions">Missions</a></li>
                <li><a href="#suggestions">Suggestions</a></li>
                <li><a href="#admin" id="adminNav" class="hidden">Admin</a></li>
            </ul>
        </nav>
        
        <div class="container">
            <section id="foundation" class="section">
                <h2 class="section-title">Foundation & Purpose</h2>
                <p>The Otaku Cast is built with the sole purpose of purely debating about anime and comics matters. It serves as a sanctuary for each individual to never shun their Otaku parts, creating a comfortable environment free of judgment, prejudice, and disorder.</p>
                
                <div class="card-container">
                    <div class="card">
                        <h3 class="card-title">Our Mission</h3>
                        <p>To expand on the knowledge that can be gathered in anime and comic discussions while fostering analytical and debating skills.</p>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">Our Vision</h3>
                        <p>To create a safe refuge where members can indulge in their Otaku hobbies without concerns, while growing individually and as a group.</p>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">Our Values</h3>
                        <p>Respect, flexibility, trust, and loyalty to the Otaku culture while maintaining order and a comfortable environment for all.</p>
                    </div>
                </div>
            </section>
            
            <section id="rules" class="section">
                <h2 class="section-title">Rules & Regulations</h2>
                
                <div class="card-container">
                    <div class="card">
                        <h3 class="card-title">Respect is Earned, Respect is a Must-Have</h3>
                        <p>We remain within boundaries of personal spaces and do not insult our own or outsiders. Respect is fundamental to being human.</p>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">Participation is Optional</h3>
                        <p>Members are not forced to participate in discussions. However, when joining, contribute meaningfully to enrich minds with knowledge.</p>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">No Spoilers Policy</h3>
                        <p>Spoiling shows for others is strictly prohibited. Always confirm if others are up to speed before discussing recent developments.</p>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">Have Fun!</h3>
                        <p>While rules are important, the ultimate goal is to have fun and enjoy our shared passion for anime and comics.</p>
                    </div>
                </div>
            </section>
            
            <section id="events" class="section">
                <h2 class="section-title">Events & Activities</h2>
                
                <div class="card-container">
                    <div class="card">
                        <h3 class="card-title">Weekly Events</h3>
                        <p>Each week, members convene online to provide suggestions for fresh anime to watch, followed by substantial reasons for their choices.</p>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">Monthly Events</h3>
                        <p>Four suggested ideas from the previous month are discussed in a series of debates, allowing for deeper analysis and discussion.</p>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">Annual Celebration</h3>
                        <p>A celebration of completed quests throughout the year, with possible in-person meetings to socialize and strengthen bonds.</p>
                    </div>
                </div>
                
                <div class="meeting-info">
                    <h3>Next Meeting Details</h3>
                    <div class="meeting-details">
                        <div>
                            <strong>Date:</strong> October 11, 2025 (Wednesday)
                        </div>
                        <div>
                            <strong>Time:</strong> 7:30 - 8:30 PM
                        </div>
                        <div>
                            <strong>Focus:</strong> Suggestion Box Event & Low-Ranking Missions
                        </div>
                    </div>
                </div>
            </section>
            
            <section id="members" class="section">
                <h2 class="section-title">Members & Leadership</h2>
                
                <div class="members-list" id="membersList">
                    <!-- Members will be loaded dynamically -->
                </div>
            </section>
            
            <section id="missions" class="section">
                <h2 class="section-title">Mission System</h2>
                
                <div class="mission-grid">
                    <div class="mission-card low-rank">
                        <div class="mission-rank">Low Rank/Difficulty</div>
                        <p>New generation anime with simpler plots, minimal world-building, and often lacking follow-up seasons. Perfect for testing group dynamics and fundamental skills.</p>
                        <p><strong>Requirements:</strong> 1 season (12-13 episodes), predictable plot, easily discerned themes.</p>
                    </div>
                    
                    <div class="mission-card intermediate-rank">
                        <div class="mission-rank">Intermediate Rank/Difficulty</div>
                        <p>Above-average missions with decent influence in the anime community. Helps understand fundamental structures for high-difficulty missions.</p>
                        <p><strong>Examples:</strong> Naruto, Gintama, Bleach</p>
                    </div>
                    
                    <div class="mission-card high-rank">
                        <div class="mission-rank">High Rank/Difficulty</div>
                        <p>Exceptionally detailed anime with distinct storytelling that captures hearts of the community. Requires significant time investment but offers great rewards.</p>
                        <p><strong>Examples:</strong> Dragon Ball Z, Attack on Titan</p>
                    </div>
                </div>
                
                <h3 style="margin-top: 2rem;">Individual Ranking System</h3>
                <div class="card-container">
                    <div class="card">
                        <h3 class="card-title">Low Rank</h3>
                        <p>To advance: Complete 10 intermediate missions + 20 individual/team matches</p>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">Intermediate Rank</h3>
                        <p>To advance: Complete 15 high-difficulty missions + 30 individual/team matches</p>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">High Difficulty Rank</h3>
                        <p>Elite members who can complete missions with little trouble. Their rank can be challenged by qualified lower-ranked members.</p>
                    </div>
                </div>
            </section>
            
            <section id="suggestions" class="section">
                <h2 class="section-title">Suggestion Box</h2>
                
                <div class="suggestion-form">
                    <h3>Submit Anime Suggestion</h3>
                    <form id="suggestionForm">
                        <div class="form-group">
                            <label for="animeName">Anime Name:</label>
                            <input type="text" id="animeName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="genre">Genre:</label>
                            <select id="genre" required>
                                <option value="">Select Genre</option>
                                <option value="action">Action</option>
                                <option value="fantasy">Fantasy</option>
                                <option value="romance">Romance</option>
                                <option value="sci-fi">Sci-Fi</option>
                                <option value="comedy">Comedy</option>
                                <option value="drama">Drama</option>
                                <option value="mystery">Mystery</option>
                                <option value="horror">Horror</option>
                                <option value="slice-of-life">Slice of Life</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="synopsis">Synopsis:</label>
                            <textarea id="synopsis" rows="3" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="reason">Why We Should Watch It:</label>
                            <textarea id="reason" rows="3" required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="missionRank">Suggested Mission Rank:</label>
                            <select id="missionRank" required>
                                <option value="">Select Rank</option>
                                <option value="low">Low</option>
                                <option value="intermediate">Intermediate</option>
                                <option value="high">High</option>
                            </select>
                        </div>
                        
                        <button type="submit">Submit Suggestion</button>
                    </form>
                </div>
                
                <div class="suggestions-list">
                    <h3>Recent Suggestions</h3>
                    <div id="suggestionsList">
                        <!-- Suggestions will be loaded dynamically -->
                    </div>
                </div>
            </section>
            
            <!-- Admin Panel (only visible to admins) -->
            <section id="admin" class="section hidden">
                <h2 class="section-title">Admin Panel</h2>
                
                <div class="tabs">
                    <div class="tab active" data-tab="users">Manage Users</div>
                    <div class="tab" data-tab="suggestions">Manage Suggestions</div>
                    <div class="tab" data-tab="meetings">Manage Meetings</div>
                </div>
                
                <div class="tab-content active" id="users-tab">
                    <h3>User Management</h3>
                    <div class="card-container" id="adminUsersList">
                        <!-- Users will be loaded dynamically -->
                    </div>
                    
                    <div class="suggestion-form">
                        <h3>Add New User</h3>
                        <form id="addUserForm">
                            <div class="form-group">
                                <label for="newUsername">Username:</label>
                                <input type="text" id="newUsername" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="newPassword">Password:</label>
                                <input type="password" id="newPassword" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="newRole">Role:</label>
                                <select id="newRole" required>
                                    <option value="member">Member</option>
                                    <option value="admin">Admin</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="newDisplayName">Display Name:</label>
                                <input type="text" id="newDisplayName" required>
                            </div>
                            
                            <button type="submit">Add User</button>
                        </form>
                    </div>
                </div>
                
                <div class="tab-content" id="suggestions-tab">
                    <h3>Suggestion Management</h3>
                    <div id="adminSuggestionsList">
                        <!-- Suggestions for admin will be loaded dynamically -->
                    </div>
                </div>
                
                <div class="tab-content" id="meetings-tab">
                    <h3>Meeting Management</h3>
                    <div class="suggestion-form">
                        <form id="meetingForm">
                            <div class="form-group">
                                <label for="meetingDate">Meeting Date:</label>
                                <input type="date" id="meetingDate" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="meetingTime">Meeting Time:</label>
                                <input type="time" id="meetingTime" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="meetingDuration">Duration (minutes):</label>
                                <input type="number" id="meetingDuration" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="meetingTopic">Meeting Topic:</label>
                                <input type="text" id="meetingTopic" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="meetingFocus">Focus:</label>
                                <textarea id="meetingFocus" rows="3" required></textarea>
                            </div>
                            
                            <button type="submit">Schedule Meeting</button>
                        </form>
                    </div>
                    
                    <div class="suggestions-list">
                        <h3>Upcoming Meetings</h3>
                        <div id="meetingsList">
                            <!-- Meetings will be loaded dynamically -->
                        </div>
                    </div>
                </div>
            </section>
        </div>
        
        <footer>
            <p>&copy; 2025 The Otaku Cast. All rights reserved.</p>
            <p>This portal is for local use by group members only.</p>
        </footer>
    </div>

    <script>
        // Database setup using PouchDB (client-side database)
        const db = new PouchDB('otaku_cast_portal');
        
        // Initialize default data
        async function initializeDatabase() {
            try {
                // Check if users already exist
                const users = await db.allDocs({ include_docs: true, startkey: 'user_', endkey: 'user_\uffff' });
                
                if (users.rows.length === 0) {
                    // Add default users
                    await db.put({
                        _id: 'user_admin',
                        username: 'admin',
                        password: 'admin123',
                        role: 'admin',
                        displayName: 'Constantine',
                        avatar: 'C'
                    });
                    
                    await db.put({
                        _id: 'user_member',
                        username: 'member',
                        password: 'member123',
                        role: 'member',
                        displayName: 'TheWalkingGhost',
                        avatar: 'T'
                    });
                    
                    // Add default members
                    await db.put({
                        _id: 'member_1',
                        name: 'Constantine',
                        role: 'Administrator',
                        status: 'present'
                    });
                    
                    await db.put({
                        _id: 'member_2',
                        name: 'TheWalkingGhost',
                        role: 'Vice-Administrator',
                        status: 'present'
                    });
                    
                    await db.put({
                        _id: 'member_3',
                        name: 'Sombra',
                        role: 'Member',
                        status: 'present'
                    });
                    
                    await db.put({
                        _id: 'member_4',
                        name: 'FatalDemon7 (Fatal)',
                        role: 'Member',
                        status: 'present'
                    });
                    
                    await db.put({
                        _id: 'member_5',
                        name: 'M.',
                        role: 'Member',
                        status: 'absent'
                    });
                    
                    await db.put({
                        _id: 'member_6',
                        name: 'SheWolf',
                        role: 'Member',
                        status: 'absent'
                    });
                    
                    // Add default meeting
                    await db.put({
                        _id: 'meeting_1',
                        date: '2025-10-11',
                        time: '19:30',
                        duration: 60,
                        topic: 'Suggestion Box Event',
                        focus: 'Low-ranking missions initiation'
                    });
                }
            } catch (error) {
                console.error('Error initializing database:', error);
            }
        }
        
        // Authentication state
        let currentUser = null;
        
        // DOM elements
        const loginScreen = document.getElementById('loginScreen');
        const mainPortal = document.getElementById('mainPortal');
        const loginForm = document.getElementById('loginForm');
        const logoutBtn = document.getElementById('logoutBtn');
        const userName = document.getElementById('userName');
        const userAvatar = document.getElementById('userAvatar');
        const adminNav = document.getElementById('adminNav');
        const adminSection = document.getElementById('admin');
        const membersList = document.getElementById('membersList');
        const suggestionsList = document.getElementById('suggestionsList');
        const suggestionForm = document.getElementById('suggestionForm');
        const adminUsersList = document.getElementById('adminUsersList');
        const adminSuggestionsList = document.getElementById('adminSuggestionsList');
        const meetingsList = document.getElementById('meetingsList');
        const addUserForm = document.getElementById('addUserForm');
        const meetingForm = document.getElementById('meetingForm');
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', async () => {
            await initializeDatabase();
            checkAuthState();
            setupEventListeners();
        });
        
        // Check if user is already logged in
        function checkAuthState() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainPortal();
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            loginForm.addEventListener('submit', handleLogin);
            logoutBtn.addEventListener('click', handleLogout);
            suggestionForm.addEventListener('submit', handleSuggestionSubmit);
            
            // Admin forms
            if (addUserForm) {
                addUserForm.addEventListener('submit', handleAddUser);
            }
            
            if (meetingForm) {
                meetingForm.addEventListener('submit', handleMeetingSubmit);
            }
            
            // Tab navigation
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            
            // Smooth scrolling for navigation links
            document.querySelectorAll('nav a').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const targetId = this.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    
                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 20,
                            behavior: 'smooth'
                        });
                    }
                });
            });
        }
        
        // Handle login
        async function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const userDoc = await db.get(`user_${username}`);
                
                if (userDoc && userDoc.password === password) {
                    currentUser = {
                        id: userDoc._id,
                        username: userDoc.username,
                        role: userDoc.role,
                        displayName: userDoc.displayName,
                        avatar: userDoc.avatar
                    };
                    
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    showMainPortal();
                    showNotification('Login successful!', 'success');
                } else {
                    showNotification('Invalid username or password', 'error');
                }
            } catch (error) {
                showNotification('Invalid username or password', 'error');
            }
        }
        
        // Handle logout
        function handleLogout() {
            currentUser = null;
            localStorage.removeItem('currentUser');
            showLoginScreen();
            showNotification('Logged out successfully', 'success');
        }
        
        // Show login screen
        function showLoginScreen() {
            loginScreen.classList.remove('hidden');
            mainPortal.classList.add('hidden');
            loginForm.reset();
        }
        
        // Show main portal
        function showMainPortal() {
            loginScreen.classList.add('hidden');
            mainPortal.classList.remove('hidden');
            
            // Update UI based on user
            userName.textContent = currentUser.displayName;
            userAvatar.textContent = currentUser.avatar;
            
            // Show/hide admin features
            if (currentUser.role === 'admin') {
                adminNav.classList.remove('hidden');
                adminSection.classList.remove('hidden');
            } else {
                adminNav.classList.add('hidden');
                adminSection.classList.add('hidden');
            }
            
            // Load data
            loadMembers();
            loadSuggestions();
            
            if (currentUser.role === 'admin') {
                loadAdminUsers();
                loadAdminSuggestions();
                loadMeetings();
            }
        }
        
        // Load members
        async function loadMembers() {
            try {
                const result = await db.allDocs({ include_docs: true, startkey: 'member_', endkey: 'member_\uffff' });
                membersList.innerHTML = '';
                
                result.rows.forEach(row => {
                    const member = row.doc;
                    const memberCard = document.createElement('div');
                    memberCard.className = `member-card ${member.role.includes('Admin') ? 'admin' : ''} ${member.role.includes('Vice') ? 'vice-admin' : ''}`;
                    
                    memberCard.innerHTML = `
                        <h3>${member.name}</h3>
                        <p>${member.role}</p>
                        <p><strong>Status:</strong> ${member.status}</p>
                    `;
                    
                    membersList.appendChild(memberCard);
                });
            } catch (error) {
                console.error('Error loading members:', error);
            }
        }
        
        // Load suggestions
        async function loadSuggestions() {
            try {
                const result = await db.allDocs({ include_docs: true, startkey: 'suggestion_', endkey: 'suggestion_\uffff' });
                suggestionsList.innerHTML = '';
                
                if (result.rows.length === 0) {
                    suggestionsList.innerHTML = '<p>No suggestions yet. Be the first to suggest an anime!</p>';
                    return;
                }
                
                result.rows.forEach(row => {
                    const suggestion = row.doc;
                    const suggestionItem = document.createElement('div');
                    suggestionItem.className = 'suggestion-item';
                    
                    suggestionItem.innerHTML = `
                        <div class="suggestion-header">
                            <div class="suggestion-title">${suggestion.animeName}</div>
                            <div class="suggestion-meta">${suggestion.genre} • ${suggestion.missionRank} rank</div>
                        </div>
                        <p><strong>Synopsis:</strong> ${suggestion.synopsis}</p>
                        <p><strong>Reason:</strong> ${suggestion.reason}</p>
                        <p><strong>Suggested by:</strong> ${suggestion.submittedBy}</p>
                    `;
                    
                    suggestionsList.appendChild(suggestionItem);
                });
            } catch (error) {
                console.error('Error loading suggestions:', error);
            }
        }
        
        // Handle suggestion submission
        async function handleSuggestionSubmit(e) {
            e.preventDefault();
            
            const animeName = document.getElementById('animeName').value;
            const genre = document.getElementById('genre').value;
            const synopsis = document.getElementById('synopsis').value;
            const reason = document.getElementById('reason').value;
            const missionRank = document.getElementById('missionRank').value;
            
            try {
                await db.put({
                    _id: `suggestion_${Date.now()}`,
                    animeName,
                    genre,
                    synopsis,
                    reason,
                    missionRank,
                    submittedBy: currentUser.displayName,
                    submittedAt: new Date().toISOString()
                });
                
                suggestionForm.reset();
                loadSuggestions();
                
                if (currentUser.role === 'admin') {
                    loadAdminSuggestions();
                }
                
                showNotification('Suggestion submitted successfully!', 'success');
            } catch (error) {
                console.error('Error submitting suggestion:', error);
                showNotification('Error submitting suggestion', 'error');
            }
        }
        
        // Load admin users
        async function loadAdminUsers() {
            try {
                const result = await db.allDocs({ include_docs: true, startkey: 'user_', endkey: 'user_\uffff' });
                adminUsersList.innerHTML = '';
                
                result.rows.forEach(row => {
                    const user = row.doc;
                    const userCard = document.createElement('div');
                    userCard.className = 'card';
                    
                    userCard.innerHTML = `
                        <h3 class="card-title">${user.displayName}</h3>
                        <p><strong>Username:</strong> ${user.username}</p>
                        <p><strong>Role:</strong> ${user.role}</p>
                        <button class="btn-danger" onclick="deleteUser('${user._id}')">Delete</button>
                    `;
                    
                    adminUsersList.appendChild(userCard);
                });
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }
        
        // Handle add user
        async function handleAddUser(e) {
            e.preventDefault();
            
            const username = document.getElementById('newUsername').value;
            const password = document.getElementById('newPassword').value;
            const role = document.getElementById('newRole').value;
            const displayName = document.getElementById('newDisplayName').value;
            
            try {
                await db.put({
                    _id: `user_${username}`,
                    username,
                    password,
                    role,
                    displayName,
                    avatar: displayName.charAt(0).toUpperCase()
                });
                
                addUserForm.reset();
                loadAdminUsers();
                showNotification('User added successfully!', 'success');
            } catch (error) {
                console.error('Error adding user:', error);
                showNotification('Error adding user', 'error');
            }
        }
        
        // Delete user
        async function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                try {
                    const user = await db.get(userId);
                    await db.remove(user);
                    loadAdminUsers();
                    showNotification('User deleted successfully', 'success');
                } catch (error) {
                    console.error('Error deleting user:', error);
                    showNotification('Error deleting user', 'error');
                }
            }
        }
        
        // Load admin suggestions
        async function loadAdminSuggestions() {
            try {
                const result = await db.allDocs({ include_docs: true, startkey: 'suggestion_', endkey: 'suggestion_\uffff' });
                adminSuggestionsList.innerHTML = '';
                
                if (result.rows.length === 0) {
                    adminSuggestionsList.innerHTML = '<p>No suggestions yet.</p>';
                    return;
                }
                
                result.rows.forEach(row => {
                    const suggestion = row.doc;
                    const suggestionItem = document.createElement('div');
                    suggestionItem.className = 'suggestion-item';
                    
                    suggestionItem.innerHTML = `
                        <div class="suggestion-header">
                            <div class="suggestion-title">${suggestion.animeName}</div>
                            <div class="suggestion-meta">${suggestion.genre} • ${suggestion.missionRank} rank</div>
                        </div>
                        <p><strong>Synopsis:</strong> ${suggestion.synopsis}</p>
                        <p><strong>Reason:</strong> ${suggestion.reason}</p>
                        <p><strong>Suggested by:</strong> ${suggestion.submittedBy}</p>
                        <button class="btn-danger" onclick="deleteSuggestion('${suggestion._id}')">Delete</button>
                    `;
                    
                    adminSuggestionsList.appendChild(suggestionItem);
                });
            } catch (error) {
                console.error('Error loading suggestions:', error);
            }
        }
        
        // Delete suggestion
        async function deleteSuggestion(suggestionId) {
            if (confirm('Are you sure you want to delete this suggestion?')) {
                try {
                    const suggestion = await db.get(suggestionId);
                    await db.remove(suggestion);
                    loadSuggestions();
                    loadAdminSuggestions();
                    showNotification('Suggestion deleted successfully', 'success');
                } catch (error) {
                    console.error('Error deleting suggestion:', error);
                    showNotification('Error deleting suggestion', 'error');
                }
            }
        }
        
        // Load meetings
        async function loadMeetings() {
            try {
                const result = await db.allDocs({ include_docs: true, startkey: 'meeting_', endkey: 'meeting_\uffff' });
                meetingsList.innerHTML = '';
                
                if (result.rows.length === 0) {
                    meetingsList.innerHTML = '<p>No meetings scheduled yet.</p>';
                    return;
                }
                
                result.rows.forEach(row => {
                    const meeting = row.doc;
                    const meetingItem = document.createElement('div');
                    meetingItem.className = 'suggestion-item';
                    
                    const meetingDate = new Date(meeting.date);
                    const formattedDate = meetingDate.toLocaleDateString();
                    
                    meetingItem.innerHTML = `
                        <div class="suggestion-header">
                            <div class="suggestion-title">${meeting.topic}</div>
                            <div class="suggestion-meta">${formattedDate} at ${meeting.time}</div>
                        </div>
                        <p><strong>Focus:</strong> ${meeting.focus}</p>
                        <p><strong>Duration:</strong> ${meeting.duration} minutes</p>
                        <button class="btn-danger" onclick="deleteMeeting('${meeting._id}')">Delete</button>
                    `;
                    
                    meetingsList.appendChild(meetingItem);
                });
            } catch (error) {
                console.error('Error loading meetings:', error);
            }
        }
        
        // Handle meeting submission
        async function handleMeetingSubmit(e) {
            e.preventDefault();
            
            const date = document.getElementById('meetingDate').value;
            const time = document.getElementById('meetingTime').value;
            const duration = document.getElementById('meetingDuration').value;
            const topic = document.getElementById('meetingTopic').value;
            const focus = document.getElementById('meetingFocus').value;
            
            try {
                await db.put({
                    _id: `meeting_${Date.now()}`,
                    date,
                    time,
                    duration: parseInt(duration),
                    topic,
                    focus,
                    createdBy: currentUser.displayName,
                    createdAt: new Date().toISOString()
                });
                
                meetingForm.reset();
                loadMeetings();
                showNotification('Meeting scheduled successfully!', 'success');
            } catch (error) {
                console.error('Error scheduling meeting:', error);
                showNotification('Error scheduling meeting', 'error');
            }
        }
        
        // Delete meeting
        async function deleteMeeting(meetingId) {
            if (confirm('Are you sure you want to delete this meeting?')) {
                try {
                    const meeting = await db.get(meetingId);
                    await db.remove(meeting);
                    loadMeetings();
                    showNotification('Meeting deleted successfully', 'success');
                } catch (error) {
                    console.error('Error deleting meeting:', error);
                    showNotification('Error deleting meeting', 'error');
                }
            }
        }
        
        // Switch tabs in admin panel
        function switchTab(tabName) {
            // Deactivate all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Activate selected tab
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }
        
        // Show notification
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }
        
        // Make functions available globally for onclick handlers
        window.deleteUser = deleteUser;
        window.deleteSuggestion = deleteSuggestion;
        window.deleteMeeting = deleteMeeting;
    </script>
</body>
</html>